# Operations

## Observability

The delivery service exposes baseline observability for external ops tooling:

- **Structured JSON logs** for API and domain actions.
- **Request IDs** (`X-Request-ID`) accepted from callers or generated by API.
- **Metrics endpoint** at `GET /metrics` (OPS/ADMIN auth required).

### Structured log fields

All service logs include these fields for correlation:

- `request_id`
- `order_id`
- `job_id`
- `drone_id`

Additional standard fields include `timestamp`, `level`, `logger`, and `message`.

### Request IDs

Clients can send an `X-Request-ID` header on any request. The API echoes it back in the response header.
If no request ID is supplied, the API generates one.

### Metrics

`GET /metrics` returns JSON with two sections:

- `counters` (e.g. `http_requests_total`)
- `timings` (aggregated timing stats with `count`, `avg_s`, `max_s`)

Timing metrics currently captured:

- `dispatch_assignment_seconds`
- `mission_intent_generation_seconds`
- `http_request_duration_seconds`


### Database configuration

Set `WINGXTRA_DATABASE_URL` to configure the SQLAlchemy connection URL.
For CI and local test safety, the service defaults to `sqlite+pysqlite:///./test.db` when unset.

Set `WINGXTRA_TESTING=true` in test environments to disable startup demo-data seeding.
This keeps API list endpoints deterministic for integration tests.

Set `WINGXTRA_UI_SERVICE_MODE` to explicitly select the UI service strategy:

- `db`: only database-backed order and tracking flows.
- `store`: only in-memory placeholder/test flows.
- `hybrid` (default): DB-backed API flows with placeholder/store adapters enabled for UI test IDs like `ord-1` and `ord-2`.
